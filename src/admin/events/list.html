<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Eventos - Admin Érika Produções</title>
    <link rel="stylesheet" href="../../../public/assets/css/admin-style.css">
    <link rel="icon" href="../../../public/favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body class="dashboard-body">
    <div class="sidebar">
        <div class="sidebar-header">
            <h3>Érika Produções</h3>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li><a href="../dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li class="active"><a href="list.html"><i class="fas fa-calendar-alt"></i> Gerenciar Eventos</a></li>
                <li><a href="new.html"><i class="fas fa-plus-circle"></i> Novo Evento</a></li>
                <li><a href="../graduation/index.html"><i class="fas fa-graduation-cap"></i> Formaturas</a></li>
                <li><a href="../weddings/index.html"><i class="fas fa-heart"></i> Casamentos</a></li>
                <li><a href="../birthdays/index.html"><i class="fas fa-birthday-cake"></i> Aniversários</a></li>
                <li><a href="../general/index.html"><i class="fas fa-concierge-bell"></i> Eventos Gerais</a></li>
                <li><a href="#"><i class="fas fa-users"></i> Clientes</a></li>
                <li><a href="../settings/index.html"><i class="fas fa-cogs"></i> Configurações</a></li>
                <li><a href="#" id="adminLogoutBtn"><i class="fas fa-sign-out-alt"></i> Sair</a></li>
            </ul>
        </nav>
    </div>

    <div class="main-content">
        <header class="main-header">
            <div class="header-title">
                <h2>Gerenciar Eventos</h2>
            </div>
            <div class="user-info">
                <span>Olá, <span id="adminUserName">Admin</span></span>
                <i class="fas fa-user-circle fa-2x"></i>
            </div>
        </header>

        <div class="content-area">
            <div class="list-actions-filters">
                <div class="filter-group">
                    <input type="text" id="searchEvent" placeholder="Buscar por nome, local...">
                    <select id="filterEventType">
                        <option value="">Todos os Tipos</option>
                        <option value="graduation">Formatura</option>
                        <option value="wedding">Casamento</option>
                        <option value="birthday">Aniversário</option>
                        <option value="general">Evento Geral</option>
                    </select>
                    <select id="filterEventStatus">
                        <option value="">Todos os Status</option>
                        <option value="planning">Planejamento</option>
                        <option value="active">Ativo</option>
                        <option value="completed">Concluído</option>
                        <option value="cancelled">Cancelado</option>
                    </select>
                    <button class="btn btn-primary" id="applyFiltersBtn"><i class="fas fa-filter"></i> Filtrar</button>
                </div>
                <a href="new.html" class="btn btn-primary"><i class="fas fa-plus"></i> Criar Novo Evento</a>
            </div>

            <div class="table-container">
                <table class="data-table" id="eventsTable">
                    <thead>
                        <tr>
                            <th>Nome do Evento</th>
                            <th>Tipo</th>
                            <th>Data</th>
                            <th>Local</th>
                            <th>Contato</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Linhas de eventos serão injetadas aqui por JS ou carregadas do Firebase -->
                        <tr>
                            <td>Formatura Turma 2025 - Engenharia</td>
                            <td>Formatura</td>
                            <td>2025-12-10</td>
                            <td>Centro de Convenções</td>
                            <td>João Coordenador</td>
                            <td><span class="status-badge status-active">Ativo</span></td>
                            <td class="action-buttons">
                                <a href="#" class="btn-view" title="Visualizar"><i class="fas fa-eye"></i></a>
                                <a href="edit.html?id=event1" class="btn-edit" title="Editar"><i class="fas fa-edit"></i></a>
                                <button class="btn-cancel" title="Cancelar Evento"><i class="fas fa-times-circle"></i></button>
                            </td>
                        </tr>
                        <tr>
                            <td>Casamento Ana e Carlos</td>
                            <td>Casamento</td>
                            <td>2025-09-20</td>
                            <td>Espaço Garden Hall</td>
                            <td>Ana Noiva</td>
                            <td><span class="status-badge status-planning">Planejamento</span></td>
                            <td class="action-buttons">
                                <a href="#" class="btn-view" title="Visualizar"><i class="fas fa-eye"></i></a>
                                <a href="edit.html?id=event2" class="btn-edit" title="Editar"><i class="fas fa-edit"></i></a>
                                <button class="btn-complete" title="Marcar como Concluído"><i class="fas fa-check-circle"></i></button>
                            </td>
                        </tr>
                        <tr>
                            <td>Aniversário de 15 anos da Sofia</td>
                            <td>Aniversário</td>
                            <td>2024-11-05</td>
                            <td>Salão Festa Kids</td>
                            <td>Maria Mãe</td>
                            <td><span class="status-badge status-completed">Concluído</span></td>
                            <td class="action-buttons">
                                <a href="#" class="btn-view" title="Visualizar"><i class="fas fa-eye"></i></a>
                                <a href="edit.html?id=event3" class="btn-edit" title="Editar"><i class="fas fa-edit"></i></a>
                                <button class="btn-delete" title="Deletar Evento (Concluído)"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>
                         <tr>
                            <td>Conferência Tech Masters</td>
                            <td>Evento Geral</td>
                            <td>2025-03-15</td>
                            <td>Expo Center</td>
                            <td>Pedro Organizador</td>
                            <td><span class="status-badge status-cancelled">Cancelado</span></td>
                            <td class="action-buttons">
                                <a href="#" class="btn-view" title="Visualizar"><i class="fas fa-eye"></i></a>
                                <!-- Editar um evento cancelado pode ou não ser permitido -->
                                <a href="edit.html?id=event4" class="btn-edit" title="Editar"><i class="fas fa-edit"></i></a> 
                                <button class="btn-delete" title="Deletar Evento (Cancelado)"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div id="noResultsMessage" style="text-align: center; padding: 20px; display: none;">
                    Nenhum evento encontrado com os filtros aplicados.
                </div>
            </div>
        </div>
    </div>

    <script src="../../../public/assets/js/firebase-config.js"></script>
    <script src="../../../public/assets/js/auth-admin.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('isAdminLoggedIn') !== 'true') {
                window.location.href = '../login.html';
            }
            const adminName = localStorage.getItem('adminUserName') || 'Admin';
            document.getElementById('adminUserName').textContent = adminName;

            // Lógica de Filtros (Simulada)
            const applyFiltersBtn = document.getElementById('applyFiltersBtn');
            const searchEventInput = document.getElementById('searchEvent');
            const filterEventType = document.getElementById('filterEventType');
            const filterEventStatus = document.getElementById('filterEventStatus');
            const eventsTableBody = document.querySelector('#eventsTable tbody');
            const noResultsMessage = document.getElementById('noResultsMessage');

            // Dados mocados para simulação
            const mockEvents = [
                { id: 'event1', name: 'Formatura Turma 2025 - Engenharia', type: 'Formatura', typeVal: 'graduation', date: '2025-12-10', location: 'Centro de Convenções', contact: 'João Coordenador', status: 'Ativo', statusVal: 'active' },
                { id: 'event2', name: 'Casamento Ana e Carlos', type: 'Casamento', typeVal: 'wedding', date: '2025-09-20', location: 'Espaço Garden Hall', contact: 'Ana Noiva', status: 'Planejamento', statusVal: 'planning' },
                { id: 'event3', name: 'Aniversário de 15 anos da Sofia', type: 'Aniversário', typeVal: 'birthday', date: '2024-11-05', location: 'Salão Festa Kids', contact: 'Maria Mãe', status: 'Concluído', statusVal: 'completed' },
                { id: 'event4', name: 'Conferência Tech Masters', type: 'Evento Geral', typeVal: 'general', date: '2025-03-15', location: 'Expo Center', contact: 'Pedro Organizador', status: 'Cancelado', statusVal: 'cancelled' }
            ];

            function renderTable(eventsToRender) {
                eventsTableBody.innerHTML = ''; // Limpa a tabela
                if (eventsToRender.length === 0) {
                    noResultsMessage.style.display = 'block';
                    return;
                }
                noResultsMessage.style.display = 'none';

                eventsToRender.forEach(event => {
                    const row = eventsTableBody.insertRow();
                    row.innerHTML = `
                        <td>${event.name}</td>
                        <td>${event.type}</td>
                        <td>${new Date(event.date + 'T00:00:00').toLocaleDateString('pt-BR')}</td>
                        <td>${event.location}</td>
                        <td>${event.contact}</td>
                        <td><span class="status-badge status-${event.statusVal}">${event.status}</span></td>
                        <td class="action-buttons">
                            <a href="#" class="btn-view" title="Visualizar" data-id="${event.id}"><i class="fas fa-eye"></i></a>
                            <a href="edit.html?id=${event.id}" class="btn-edit" title="Editar"><i class="fas fa-edit"></i></a>
                            ${event.statusVal !== 'completed' && event.statusVal !== 'cancelled' ? 
                                `<button class="btn-cancel" title="Cancelar Evento" data-id="${event.id}"><i class="fas fa-times-circle"></i></button>` : ''}
                            ${event.statusVal === 'planning' || event.statusVal === 'active' ? 
                                `<button class="btn-complete" title="Marcar como Concluído" data-id="${event.id}"><i class="fas fa-check-circle"></i></button>` : ''}
                            ${event.statusVal === 'completed' || event.statusVal === 'cancelled' ? 
                                `<button class="btn-delete" title="Deletar Evento" data-id="${event.id}"><i class="fas fa-trash"></i></button>` : ''}
                        </td>
                    `;
                });
                addEventListenersToButtons();
            }
            
            function filterEvents() {
                const searchTerm = searchEventInput.value.toLowerCase();
                const typeFilter = filterEventType.value;
                const statusFilter = filterEventStatus.value;

                const filteredEvents = mockEvents.filter(event => {
                    const matchesSearch = event.name.toLowerCase().includes(searchTerm) || 
                                          event.location.toLowerCase().includes(searchTerm) ||
                                          event.contact.toLowerCase().includes(searchTerm);
                    const matchesType = typeFilter ? event.typeVal === typeFilter : true;
                    const matchesStatus = statusFilter ? event.statusVal === statusFilter : true;
                    return matchesSearch && matchesType && matchesStatus;
                });
                renderTable(filteredEvents);
            }

            applyFiltersBtn.addEventListener('click', filterEvents);
            searchEventInput.addEventListener('keyup', (e) => { // Filtra ao digitar
                if (e.key === "Enter" || searchEventInput.value.length === 0 || searchEventInput.value.length > 2) {
                    filterEvents();
                }
            });
            filterEventType.addEventListener('change', filterEvents);
            filterEventStatus.addEventListener('change', filterEvents);
            
            function addEventListenersToButtons() {
                document.querySelectorAll('.btn-view').forEach(btn => btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    alert(`Visualizar evento ID: ${e.currentTarget.dataset.id} (Não implementado)`);
                }));
                document.querySelectorAll('.btn-cancel').forEach(btn => btn.addEventListener('click', (e) => {
                    if(confirm('Tem certeza que deseja CANCELAR este evento?')) {
                        alert(`Cancelar evento ID: ${e.currentTarget.dataset.id} (Simulado)`);
                        // Aqui você atualizaria o status no Firebase e recarregaria a lista
                    }
                }));
                document.querySelectorAll('.btn-complete').forEach(btn => btn.addEventListener('click', (e) => {
                     if(confirm('Tem certeza que deseja marcar este evento como CONCLUÍDO?')) {
                        alert(`Concluir evento ID: ${e.currentTarget.dataset.id} (Simulado)`);
                    }
                }));
                document.querySelectorAll('.btn-delete').forEach(btn => btn.addEventListener('click', (e) => {
                     if(confirm('Tem certeza que deseja DELETAR este evento? Esta ação não pode ser desfeita.')) {
                        alert(`Deletar evento ID: ${e.currentTarget.dataset.id} (Simulado)`);
                        // Aqui você removeria o evento do Firebase e recarregaria a lista
                    }
                }));
            }

            // Carregamento inicial
            renderTable(mockEvents);
        });
    </script>
</body>
</html>